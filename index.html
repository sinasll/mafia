<!DOCTYPE html>
<html lang="ku" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ø´Û•Ú¤Ø§ Ù…Ø§ÙÛŒØ§ÛŒ </title>
    <style>
        /* --- Core Variables and Reset --- */
        :root {
            --bg-deep: #030303;
            --bg-card: #0e0e0e;
            --blood-red: #990000;
            --accent-red: #ff3333;
            --text-light: #e0e0e0;
            --text-muted: #666;
            --border-dark: #222;
        }

        * {
            box-sizing: border-box;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            font-family: 'Tahoma', 'Segoe UI', sans-serif;
            transition: background-color 0.3s, color 0.3s, transform 0.2s, opacity 0.3s;
        }

        body {
            margin: 0;
            padding: 0;
            background-color: var(--bg-deep);
            color: var(--text-light);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        /* --- Global Structure and Horror Theme --- */
        body::before {
            content: "";
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle at center, rgba(153, 0, 0, 0.1) 0%, rgba(0, 0, 0, 0.8) 70%);
            z-index: -1;
        }

        .container {
            width: 95%;
            max-width: 500px;
            padding: 20px 10px;
            text-align: center;
        }

        .screen {
            padding: 10px;
            animation: fadeIn 0.5s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* --- Typography --- */
        h1 {
            color: var(--blood-red);
            font-size: 2.5rem;
            text-shadow: 0 0 10px rgba(153, 0, 0, 0.7);
            border-bottom: 2px solid var(--blood-red);
            padding-bottom: 10px;
            margin-bottom: 25px;
        }

        h2 {
            color: #fff;
            font-size: 1.5rem;
            margin-bottom: 20px;
        }

        /* --- Buttons --- */
        .btn {
            width: 100%;
            padding: 18px 25px;
            margin-top: 15px;
            border: none;
            border-radius: 8px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
        }

        .btn-primary {
            background: linear-gradient(145deg, var(--accent-red), var(--blood-red));
            color: white;
            box-shadow: 0 0 10px var(--blood-red);
        }
        .btn-primary:active { transform: scale(0.98); background: var(--blood-red); }

        .btn-secondary {
            background: var(--bg-card);
            color: var(--text-light);
            border: 1px solid var(--border-dark);
            box-shadow: none;
            margin-top: 10px;
            font-size: 1rem;
        }

        /* --- Player Management --- */
        .player-add {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .input-field {
            flex-grow: 1;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid var(--border-dark);
            background: #000;
            color: var(--text-light);
            font-size: 1rem;
            outline: none;
        }
        .input-field:focus { border-color: var(--blood-red); }

        .btn-icon-add {
            padding: 0 18px;
            font-size: 1.5rem;
            background: var(--blood-red);
            border: none;
            color: white;
            border-radius: 8px;
        }

        .player-list {
            max-height: 250px;
            overflow-y: auto;
            margin-bottom: 20px;
            padding-right: 5px;
        }

        .player-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--bg-card);
            padding: 12px 15px;
            margin-bottom: 8px;
            border-radius: 8px;
            border-left: 5px solid var(--border-dark);
        }

        .player-name-text { font-size: 1.1rem; }

        .player-actions { display: flex; gap: 10px; }

        .action-btn {
            background: none;
            border: none;
            font-size: 1.2rem;
            cursor: pointer;
            opacity: 0.8;
            padding: 5px;
        }
        .btn-edit { color: #50aaff; }
        .btn-delete { color: var(--accent-red); }
        .action-btn:active { transform: scale(0.9); opacity: 1; }

        .player-stats { color: #ccc; margin-bottom: 15px; }

        /* --- Role Configuration --- */
        .settings-grid {
            background: rgba(255,255,255,0.05);
            padding: 15px;
            border-radius: 12px;
            border: 1px solid var(--border-dark);
            margin-bottom: 25px;
        }
        .role-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255,255,255,0.08);
        }
        .role-row:last-child { border-bottom: none; }

        .role-label { font-size: 1.1rem; }
        .role-input {
            width: 55px;
            text-align: center;
            padding: 8px;
            background: #000;
            border: 1px solid #444;
            color: #fff;
            border-radius: 5px;
        }
        .auto-sivil { color: #50aaff; font-weight: bold; }

        /* --- Game Card Display --- */
        .card-stage {
            height: 300px;
            position: relative;
            margin: 30px 0;
        }

        .card-container {
            width: 100%;
            height: 100%;
            background: var(--bg-card);
            border: 3px solid var(--border-dark);
            border-radius: 15px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            box-shadow: 0 0 20px rgba(0,0,0,0.7);
        }

        .card-container.revealed {
            border-color: var(--blood-red);
            background: #1a0505;
        }

        .big-icon { font-size: 5rem; color: #fff; filter: drop-shadow(0 0 5px rgba(255,255,255,0.1)); }

        .role-title {
            font-size: 2.8rem;
            font-weight: bold;
            margin-top: 10px;
            animation: textPulse 1s infinite alternate;
        }
        .player-turn-name { font-size: 1.4rem; color: #ccc; margin-bottom: 15px; }
        .instruction-pass { color: var(--text-muted); font-size: 1rem; margin-top: 20px; }

        @keyframes textPulse {
            from { opacity: 1; }
            to { opacity: 0.8; }
        }

        /* Role Colors for Moderator */
        .role-mafia { color: var(--accent-red); }
        .role-doctor { color: #33ff99; }
        .role-police { color: #3399ff; }
        .role-sivil { color: #ccc; }

        /* --- Moderator Table --- */
        .mod-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: var(--bg-card);
            border-radius: 8px;
            overflow: hidden;
        }
        .mod-table th, .mod-table td {
            padding: 12px;
            text-align: center;
            border-bottom: 1px solid var(--border-dark);
        }
        .mod-table th {
            background: #400000;
            color: #fff;
        }
        .mod-table tr:last-child td { border-bottom: none; }

        /* --- Utility Classes --- */
        .hidden { display: none !important; }
    </style>
</head>
<body>

    <div class="container">

        <!-- SCREEN 1: SETUP & PLAYER MANAGER -->
        <div id="setup-screen" class="screen">
            <h1>Ø±ÛÚ©Ø®Ø³ØªÙ†Ø§ ÛŒØ§Ø±ÛŒÛ</h1>

            <p style="color: #ccc; margin-bottom: 15px;">1. Ù†Ø§Ú¤ÛÙ† ÛŒØ§Ø±ÛŒÚ©Û•Ø±Ø§Ù† ØªÛ†Ù…Ø§Ø± Ø¨Ú©Û•:</p>

            <!-- Player Input -->
            <div class="player-add">
                <input type="text" id="new-player-name" class="input-field" placeholder="Ù†Ø§Ú¤Û ÛŒØ§Ø±ÛŒÚ©Û•Ø±ÛŒ Ø¨Ù†Ú¤ÛŒØ³Û•..." onkeypress="handleEnter(event)">
                <button class="btn-icon-add" onclick="addPlayer()">+</button>
            </div>

            <!-- Player List -->
            <div id="players-container" class="player-list">
                <!-- JS will inject players here -->
            </div>

            <div class="player-stats" id="player-count-display">0 ÛŒØ§Ø±ÛŒÚ©Û•Ø± Ø¦Ø§Ù…Ø§Ø¯Û•Ù†Û•</div>

            <p style="color: #ccc; margin-bottom: 15px; border-top: 1px solid #222; padding-top:15px;">2. Ø±ÙˆÙ„ÛÙ† ØªØ§ÛŒØ¨Û•Øª Ø¯ÛŒØ§Ø± Ø¨Ú©Û•:</p>

            <!-- Roles Settings -->
            <div class="settings-grid">
                <div class="role-row">
                    <label class="role-label role-mafia">Ù…Ø§ÙÛŒØ§ ğŸ‘¹</label>
                    <input type="number" id="inp-mafia" class="role-input" value="1" min="1" onchange="updateCalculations()">
                </div>
                <div class="role-row">
                    <label class="role-label role-doctor">Ø¯ÙˆÚ©ØªÙˆØ± ğŸ’‰</label>
                    <input type="number" id="inp-doc" class="role-input" value="1" min="0" onchange="updateCalculations()">
                </div>
                <div class="role-row">
                    <label class="role-label role-police">Ù¾ÙˆÙ„ÛŒØ³ ğŸ”«</label>
                    <input type="number" id="inp-police" class="role-input" value="1" min="0" onchange="updateCalculations()">
                </div>
                <div class="role-row">
                    <label class="role-label role-sivil">Ø³Ú¤ÛŒÙ„ ğŸ‘¤</label>
                    <span id="calc-sivil" class="auto-sivil">0</span>
                </div>
            </div>

            <button class="btn btn-primary" onclick="validateAndStartGame()">Ø¯Û•Ø³ØªÙ¾ÛÚ©Ø±Ù†Ø§ Ø¯Ø§Ø¨Û•Ø´Ú©Ø±Ù†Ø§ Ú©Ø§Ø±ØªØ§Ù†</button>
            <button class="btn btn-secondary" onclick="clearAllData()">Ú˜ÛØ¨Ø±Ù†Ø§ Ù‡Û•Ù…ÛŒ Ø¯Ø§ØªØ§ÛŒØ§Ù†</button>
        </div>

        <!-- SCREEN 2: GAMEPLAY (PASS & PLAY) -->
        <div id="game-screen" class="screen hidden">
            <h2 id="turn-indicator">Ù†Û†Ø±Û•ÛŒØ§...</h2>

            <div class="card-stage">
                <div class="card-container" id="game-card">
                    <!-- State 1: Hidden (Default) -->
                    <div id="state-hidden">
                        <div class="big-icon">ğŸ‘ï¸</div>
                        <div class="player-turn-name" id="display-name">...</div>
                        <p class="instruction-pass">Ù…ÙˆØ¨Ø§ÛŒÙ„Û Ø¨Ø¯Û• Ú¤ÛŒ ÛŒØ§Ø±ÛŒÚ©Û•Ø±ÛŒ</p>
                        <p style="color:white; margin-top:10px;">Ø±ÙˆÙ„Û Ø®Ùˆ Ø¯ Ú©Ø§Ø±ØªØ§ Ø®Ùˆ Ø¯Ø§ Ø¨Ø¨ÛŒÙ†Û•</p>
                    </div>

                    <!-- State 2: Revealed (Hidden by default) -->
                    <div id="state-revealed" class="hidden">
                        <div class="big-icon" id="role-emoji"></div>
                        <div class="role-title" id="role-text"></div>
                    </div>

                    <!-- State 3: Pass Prompt (Hidden by default) -->
                    <div id="state-pass-prompt" class="hidden">
                        <div class="big-icon" style="font-size: 3rem;">ğŸ‘ˆ</div>
                        <h2>Ú©Ø§Ø±Øª Ù‡Ø§ØªÛ• Ú¤Û•Ø´Ø§Ø±ØªÙ†</h2>
                    </div>
                </div>
            </div>

            <button class="btn btn-primary" id="action-btn" onclick="handleCardAction()">Ú¤Û•Ú©Ø±Ù†Ø§ Ú©Ø§Ø±ØªÛ</button>
        </div>

        <!-- SCREEN 3: MODERATOR VIEW -->
        <div id="moderator-screen" class="screen hidden">
            <h1>Ø´Ø§Ø´Ø§ Ú•ÛÚ¤Û•Ø¨Û•Ø±ÛŒ</h1>
            <p style="color:var(--accent-red); font-size:1rem;">Ù‡ÛŒÚ¤ÛŒÛŒÛ•: Ø¦Û•Ú¤ Ø´Ø§Ø´Û• Ø¨ØªÙ†Û Ø¨Û† Ú•ÛÚ¤Û•Ø¨Û•Ø±ÛŒ ÛŒÛ• Ùˆ Ù†Ø§Ø¨ÛŒØª Ú©Û•Ø³ Ø¨Ø¨ÛŒÙ†ÛŒØª!</p>

            <div id="table-wrapper">
                <!-- Table JS generated -->
            </div>

            <button class="btn btn-secondary btn-restart" onclick="switchToScreen('setup-screen')">Ø¯Û•Ø³ØªÙ¾ÛÚ©Ø±Ù†Ø§ ÛŒØ§Ø±ÛŒÛŒÛ•Ú©Ø§ Ù†ÙˆÙˆ</button>
        </div>

    </div>

    <script>
        // --- Global State ---
        let players = []; // Array of names
        let gameRoles = []; // Final distribution: [{name, role, emoji, type}, ...]
        let currentIndex = 0;
        let currentScreen = 'setup-screen';

        // --- DOM Selectors ---
        const screens = ['setup-screen', 'game-screen', 'moderator-screen'];
        const playerInput = document.getElementById('new-player-name');
        const playersContainer = document.getElementById('players-container');
        const countDisplay = document.getElementById('player-count-display');
        const roleInputs = {
            m: document.getElementById('inp-mafia'),
            d: document.getElementById('inp-doc'),
            p: document.getElementById('inp-police')
        };
        const sivilCalc = document.getElementById('calc-sivil');

        // --- Initial Load ---
        window.onload = function() {
            loadData();
            renderPlayers();
            updateCalculations();
            // Add listeners for calculation update
            Object.values(roleInputs).forEach(inp => inp.addEventListener('input', updateCalculations));
        };

        // --- 1. PLAYER & SETTINGS MANAGEMENT ---

        function updateCalculations() {
            const m = parseInt(roleInputs.m.value) || 0;
            const d = parseInt(roleInputs.d.value) || 0;
            const p = parseInt(roleInputs.p.value) || 0;
            const totalPlayers = players.length;

            const assigned = m + d + p;
            const civils = totalPlayers - assigned;

            sivilCalc.innerText = civils >= 0 ? civils : "Ú† Ú©Û•Ø³ Ø¦Ø§Ù…Ø§Ø¯Û• Ù†ÛŒÙ†Ù†";
            sivilCalc.style.color = civils >= 0 ? '#50aaff' : 'var(--accent-red)';

            saveData(); // Save latest settings
        }

        function addPlayer() {
            const name = playerInput.value.trim();
            if (name && name.length > 1) {
                players.push(name);
                playerInput.value = '';
                saveData();
                renderPlayers();
                updateCalculations();
                // Smooth scroll to see the new player
                setTimeout(() => playersContainer.scrollTop = playersContainer.scrollHeight, 50);
            }
        }

        function handleEnter(e) {
            if (e.key === 'Enter') addPlayer();
        }

        function removePlayer(index) {
            if (confirm("Ø¯Û ÛŒØ§Ø±ÛŒÚ©Û•Ø±Û ( " + players[index] + " ) Ù‡ÛØªÛ• Ú˜ÛØ¨Ø±Ù†. Ù¾Ø´ØªØ±Ø§Ø³ØªÛŒØŸ")) {
                players.splice(index, 1);
                saveData();
                renderPlayers();
                updateCalculations();
            }
        }

        function editPlayer(index) {
            const newName = prompt("Ù†Ø§Ú¤Û Ù†ÙˆÛŒ Ø¨Û† ( " + players[index] + " ) Ø¨Ù†Ú¤ÛŒØ³Û•:", players[index]);
            if (newName && newName.trim() !== "" && newName.trim().length > 1) {
                players[index] = newName.trim();
                saveData();
                renderPlayers();
            }
        }

        function renderPlayers() {
            playersContainer.innerHTML = '';

            if (players.length === 0) {
                playersContainer.innerHTML = '<p style="text-align:center; color:var(--text-muted); padding: 10px;">Ú† ÛŒØ§Ø±ÛŒÚ©Û•Ø± Ù†ÛŒÙ†Ù†. Ù†Ø§Ú¤Û•Ú©ÛŒ Ø¨Ù†Ú¤ÛŒØ³Û•.</p>';
            }

            players.forEach((player, index) => {
                const div = document.createElement('div');
                div.className = 'player-item';
                div.innerHTML = `
                    <span class="player-name-text">${index + 1}. ${player}</span>
                    <div class="player-actions">
                        <button class="action-btn btn-edit" onclick="editPlayer(${index})">âœ</button>
                        <button class="action-btn btn-delete" onclick="removePlayer(${index})">âœ–</button>
                    </div>
                `;
                playersContainer.appendChild(div);
            });

            countDisplay.innerText = `${players.length} ÛŒØ§Ø±ÛŒÚ©Û•Ø± Ø¦Ø§Ù…Ø§Ø¯Û•Ù†Û•`;
        }

        // --- Local Storage ---
        function saveData() {
            localStorage.setItem('mafia_players_v3', JSON.stringify(players));
            const settings = { m: roleInputs.m.value, d: roleInputs.d.value, p: roleInputs.p.value };
            localStorage.setItem('mafia_settings_v3', JSON.stringify(settings));
        }

        function loadData() {
            const storedPlayers = localStorage.getItem('mafia_players_v3');
            if (storedPlayers) players = JSON.parse(storedPlayers);

            const storedSettings = localStorage.getItem('mafia_settings_v3');
            if (storedSettings) {
                const s = JSON.parse(storedSettings);
                roleInputs.m.value = s.m;
                roleInputs.d.value = s.d;
                roleInputs.p.value = s.p;
            }
        }

        function clearAllData() {
            if(confirm("Ø¯ÚµÙ†ÛŒØ§ÛŒ Ù‡Û•Ù…ÛŒ Ø¯Ø§ØªØ§ÛŒÛÙ† Ù†Ø§Ú¤ÛÙ† ÛŒØ§Ø±ÛŒÚ©Û•Ø±Ø§Ù† Ùˆ Ø±ÛÚ©Ø®Ø³ØªÙ† Ø¨Ù‡ÛØªÛ• Ø³Ú•ÛŒÙ†Û•ÙˆÛ•ØŸ")) {
                localStorage.removeItem('mafia_players_v3');
                localStorage.removeItem('mafia_settings_v3');
                players = [];
                location.reload(); // Quickest way to reset UI fully
            }
        }

        // --- 2. GAME DISTRIBUTION LOGIC ---

        function validateAndStartGame() {
            const m = parseInt(roleInputs.m.value) || 0;
            const d = parseInt(roleInputs.d.value) || 0;
            const p = parseInt(roleInputs.p.value) || 0;
            const required = m + d + p;
            const civilCount = players.length - required;

            if (players.length < 4) {
                alert("Ù¾ÛØ¯Ú¤ÛŒÛ• Ú©ÛÙ…ØªØ± Ú˜ 4 ÛŒØ§Ø±ÛŒÚ©Û•Ø±Ø§Ù† Ù†Û•Ø¨Ù†.");
                return;
            }
            if (civilCount < 0) {
                alert("Ù‡Û•Ú˜Ù…Ø§Ø±Ø§ Ø±ÙˆÙ„ÛÙ† ØªØ§ÛŒØ¨Û•Øª (Ù…Ø§ÙÛŒØ§, Ø¯ÙˆÚ©ØªÙˆØ±, Ù¾ÙˆÙ„ÛŒØ³) Ú˜ Ù‡Û•Ú˜Ù…Ø§Ø±Ø§ Ú¯Ø´ØªÛŒ ÛŒØ§ ÛŒØ§Ø±ÛŒÚ©Û•Ø±Ø§Ù† Ø²ÛØ¯Û•ØªØ±Û•.");
                return;
            }
            if (m === 0) {
                 alert("Ù¾ÛØ¯Ú¤ÛŒÛ• Ù‡Ú˜Ù…Ø§Ø±Ø§ Ù…Ø§ÙÛŒØ§ÛŒØ§Ù† (Ú©ÛÙ…ØªØ± 1) Ù†Û•Ø¨ÛŒØª.");
                 return;
            }

            // Generate Roles
            let roleDeck = [];
            for(let i=0; i<m; i++) roleDeck.push({role: "Ù…Ø§ÙÛŒØ§", emoji: "ğŸ‘¹", type: "role-mafia"});
            for(let i=0; i<d; i++) roleDeck.push({role: "Ø¯ÙˆÚ©ØªÙˆØ±", emoji: "ğŸ’‰", type: "role-doctor"});
            for(let i=0; i<p; i++) roleDeck.push({role: "Ù¾ÙˆÙ„ÛŒØ³", emoji: "ğŸ”«", type: "role-police"});
            for(let i=0; i<civilCount; i++) roleDeck.push({role: "Ø³Ú¤ÛŒÙ„", emoji: "ğŸ‘¤", type: "role-sivil"});

            // Shuffle Roles (Fisher-Yates)
            for (let i = roleDeck.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [roleDeck[i], roleDeck[j]] = [roleDeck[j], roleDeck[i]];
            }

            // Assign to Players
            gameRoles = players.map((name, i) => ({
                name: name,
                role: roleDeck[i].role,
                emoji: roleDeck[i].emoji,
                type: roleDeck[i].type
            }));

            currentIndex = 0;
            switchToScreen('game-screen');
            loadTurn();
        }

        // --- 3. PASS & PLAY FLOW ---

        function loadTurn() {
            // Player who is about to take the phone
            const player = gameRoles[currentIndex];

            // Set UI elements to Hidden State (State 1)
            document.getElementById('turn-indicator').innerText = `Ù†Û†Ø±Û•ÛŒØ§ ${currentIndex + 1} Ú˜ ${gameRoles.length}`;
            document.getElementById('display-name').innerText = player.name;

            document.getElementById('game-card').classList.remove('revealed');
            document.getElementById('state-hidden').classList.remove('hidden');
            document.getElementById('state-revealed').classList.add('hidden');
            document.getElementById('state-pass-prompt').classList.add('hidden');

            // Set Button Action to Reveal
            const btn = document.getElementById('action-btn');
            btn.innerText = "Ú¤Û•Ú©Ø±Ù†Ø§ Ú©Ø§Ø±ØªÛ";
            btn.onclick = handleCardAction;
            btn.classList.add('btn-primary');
            btn.classList.remove('btn-secondary');
        }

        function handleCardAction() {
            // This function handles the *first* click (Reveal Card)
            if (!document.getElementById('state-hidden').classList.contains('hidden')) {
                revealCard();
            } else {
                // This means the button was "Ú©Ø§Ø±ØªÛ Ú¤Û•Ø´ÛØ±Û•". Go to next step.
                prepareForNextPlayer();
            }
        }

        function revealCard() {
            const player = gameRoles[currentIndex];

            // UI Changes to Revealed State (State 2)
            document.getElementById('game-card').classList.add('revealed');
            document.getElementById('state-hidden').classList.add('hidden');
            document.getElementById('state-revealed').classList.remove('hidden');

            const roleTitle = document.getElementById('role-text');
            roleTitle.innerText = player.role;
            roleTitle.className = `role-title ${player.type}`;
            document.getElementById('role-emoji').innerText = player.emoji;

            // Set Button Action to Hide/Pass
            const btn = document.getElementById('action-btn');

            // Per request: Button is always "Ú©Ø§Ø±ØªÛ Ú¤Û•Ø´ÛØ±Û•" at this stage
            btn.innerText = "Ú©Ø§Ø±ØªÛ Ú¤Û•Ø´ÛØ±Û•";

            btn.classList.remove('btn-primary');
            btn.classList.add('btn-secondary');
            btn.onclick = passPrompt; // Next step is the pass prompt
        }

        function passPrompt() {
            // UI Changes to Pass Prompt State (State 3)
            document.getElementById('game-card').classList.remove('revealed');
            document.getElementById('state-revealed').classList.add('hidden');
            document.getElementById('state-pass-prompt').classList.remove('hidden');

            const btn = document.getElementById('action-btn');
            if (currentIndex < gameRoles.length - 1) {
                btn.innerText = "ÛŒØ§Ø±ÛŒÚ©Û•Ø±Û Ø¯ÙˆÛŒÙ Ø¯Ø§";
                btn.onclick = nextTurn;
            } else {
                btn.innerText = "Ú†ÙˆÙˆÙ†Ø§ Ø³Û•Ø± Ø´Ø§Ø´Ø§ Ú•ÛÚ¤Û•Ø¨Û•Ø±ÛŒ";
                btn.onclick = showModerator;
            }
            btn.classList.add('btn-primary');
            btn.classList.remove('btn-secondary');
        }

        function nextTurn() {
            currentIndex++;
            loadTurn();
        }

        function showModerator() {
            switchToScreen('moderator-screen');
            renderModeratorTable();
        }

        // --- 4. MODERATOR VIEW ---

        function renderModeratorTable() {
            const tableWrapper = document.getElementById('table-wrapper');
            let html = `<table class="mod-table">
                        <thead><tr><th>ÛŒØ§Ø±ÛŒÚ©Û•Ø±</th><th>Ø±ÙˆÙ„</th></tr></thead>
                        <tbody>`;

            gameRoles.forEach((p, index) => {
                html += `<tr>
                            <td>${index + 1}. ${p.name}</td>
                            <td class="${p.type}" style="font-weight: bold;">${p.role} ${p.emoji}</td>
                         </tr>`;
            });
            html += `</tbody></table>`;
            tableWrapper.innerHTML = html;
        }

        // --- 5. UTILITY ---
        function switchToScreen(id) {
            screens.forEach(s => {
                document.getElementById(s).classList.add('hidden');
                document.getElementById(s).classList.remove('fadeIn');
            });
            document.getElementById(id).classList.remove('hidden');
            document.getElementById(id).classList.add('fadeIn');
            currentScreen = id;
            window.scrollTo(0, 0); // Scroll to top for mobile UX
        }

    </script>
</body>
</html>

